---
interface Props {
  message: string;
  button: {
    text: string;
    href: string;
    icon?: string;
  };
  position?: 'top' | 'bottom';
  showAfterScroll?: number;
  dismissible?: boolean;
  variant?: 'primary' | 'dark';
  sectionId?: string;
  className?: string;
}

const {
  message,
  button,
  position = 'bottom',
  showAfterScroll = 300,
  dismissible = true,
  variant = 'primary',
  sectionId = 'cta-floating',
  className = ''
} = Astro.props;
---

<div
    class={`cta-floating cta-floating-${position} cta-floating-${variant} ${className}`}
    id={sectionId}
    data-show-after={showAfterScroll}
>
    <div class="cta-floating-container">
        <div class="cta-floating-content">
            <p class="cta-floating-message">{message}</p>

            <a href={button.href} class="cta-floating-button">
                {button.icon && (
                    <span class="material-symbols-outlined">{button.icon}</span>
                )}
                {button.text}
            </a>
        </div>

        {dismissible && (
            <button class="cta-floating-dismiss" aria-label="Dismiss">
                <span class="material-symbols-outlined">close</span>
            </button>
        )}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const ctaFloating = document.getElementById('cta-floating');
    if (!ctaFloating) return;

    const showAfter = parseInt(ctaFloating.getAttribute('data-show-after') || '300');
    const dismissBtn = ctaFloating.querySelector('.cta-floating-dismiss');

    // Check if user has dismissed this CTA before
    const isDismissed = localStorage.getItem('cta-floating-dismissed') === 'true';
    if (isDismissed) return;

    // Show CTA after scrolling
    let hasShown = false;
    window.addEventListener('scroll', () => {
        if (!hasShown && window.scrollY > showAfter) {
            ctaFloating.classList.add('show');
            hasShown = true;
        }
    });

    // Dismiss functionality
    if (dismissBtn) {
        dismissBtn.addEventListener('click', () => {
            ctaFloating.classList.remove('show');
            localStorage.setItem('cta-floating-dismissed', 'true');
        });
    }
});
</script>

<style>
.cta-floating {
    position: fixed;
    left: 0;
    right: 0;
    z-index: 1000;
    transform: translateY(100%);
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 -4px 24px rgba(0, 0, 0, 0.15);
}

.cta-floating-top {
    top: 0;
    transform: translateY(-100%);
}

.cta-floating-bottom {
    bottom: 0;
    transform: translateY(100%);
}

.cta-floating.show.cta-floating-top {
    transform: translateY(0);
}

.cta-floating.show.cta-floating-bottom {
    transform: translateY(0);
}

.cta-floating-primary {
    background: linear-gradient(135deg, #1A73E8 0%, #34A853 100%);
}

.cta-floating-dark {
    background: #202124;
}

.cta-floating-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 16px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 24px;
}

.cta-floating-content {
    display: flex;
    align-items: center;
    gap: 24px;
    flex: 1;
}

.cta-floating-message {
    font-size: 1rem;
    font-weight: 600;
    color: #FFFFFF;
    margin: 0;
    line-height: 1.5;
}

.cta-floating-button {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    font-size: 0.9375rem;
    font-weight: 600;
    background: #FFFFFF;
    color: #1A73E8;
    border-radius: 100px;
    text-decoration: none;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.cta-floating-dark .cta-floating-button {
    color: #202124;
}

.cta-floating-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.cta-floating-button .material-symbols-outlined {
    font-size: 1.125rem;
}

.cta-floating-dismiss {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    flex-shrink: 0;
}

.cta-floating-dismiss:hover {
    background: rgba(255, 255, 255, 0.3);
}

.cta-floating-dismiss .material-symbols-outlined {
    font-size: 1.25rem;
    color: #FFFFFF;
}

@media (max-width: 768px) {
    .cta-floating-container {
        padding: 12px 16px;
        gap: 16px;
    }

    .cta-floating-content {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
        text-align: center;
    }

    .cta-floating-message {
        font-size: 0.9375rem;
    }

    .cta-floating-button {
        width: 100%;
        justify-content: center;
    }

    .cta-floating-dismiss {
        position: absolute;
        top: 8px;
        right: 8px;
    }
}
</style>
