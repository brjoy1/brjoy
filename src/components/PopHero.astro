---
interface Props {
    dynamicWords: string[];
    title: string;
    highlightedText: string;
    subtitle: string;
    boldText?: string;
    primaryButton: {
        text: string;
        href: string;
        icon?: string;
    };
    secondaryButton?: {
        text: string;
        href: string;
        icon?: string;
    };
    trustBadges?: Array<{
        icon: string;
        text: string;
    }>;
}

const {
    dynamicWords,
    title,
    highlightedText,
    subtitle,
    boldText,
    primaryButton,
    secondaryButton,
    trustBadges,
} = Astro.props;
---

<section class="hero" data-dynamic-words={JSON.stringify(dynamicWords)}>
    <canvas id="hero-particles"></canvas>
    <div class="container hero-container">
        <h1 class="hero-title">
            <span class="dynamic-word-wrapper">
                <span id="dynamic-word">{dynamicWords[0]}</span>
            </span>
            {title}
            <span class="gradient-text">{highlightedText}</span>
        </h1>
        <p class="hero-subtitle">
            {
                boldText && boldText.trim()
                    ? subtitle.split(boldText).map((part, index, array) =>
                          index < array.length - 1 ? (
                              <>
                                  {part}
                                  <span class="audience-bold">{boldText}</span>
                              </>
                          ) : (
                              part
                          ),
                      )
                    : subtitle
            }
        </p>
        <div class="hero-actions">
            <a
                href={primaryButton.href}
                target="_blank"
                rel="noopener noreferrer"
                class="btn-whatsapp"
                aria-label={primaryButton.text}
            >
                {
                    primaryButton.icon && (
                        <span
                            class="material-symbols-outlined"
                            aria-hidden="true"
                        >
                            {primaryButton.icon}
                        </span>
                    )
                }
                {primaryButton.text}
            </a>
            {
                secondaryButton && (
                    <a
                        href={secondaryButton.href}
                        class="btn-secondary"
                        aria-label={secondaryButton.text}
                    >
                        {secondaryButton.icon && (
                            <span
                                class="material-symbols-outlined"
                                aria-hidden="true"
                            >
                                {secondaryButton.icon}
                            </span>
                        )}
                        {secondaryButton.text}
                    </a>
                )
            }
        </div>
        {
            trustBadges && trustBadges.length > 0 && (
                <div
                    class="hero-trust-badges"
                    role="list"
                    aria-label="BenefÃ­cios principais"
                >
                    {trustBadges.map((badge) => (
                        <div class="trust-badge" role="listitem">
                            <span
                                class="material-symbols-outlined"
                                aria-hidden="true"
                            >
                                {badge.icon}
                            </span>
                            <span>{badge.text}</span>
                        </div>
                    ))}
                </div>
            )
        }
    </div>
</section>

<script>
    import { initHeroAnimation } from "../scripts/hero-animation.js";

    // Get dynamic words from data attribute to pass to script
    const heroSection = document.querySelector(".hero");
    let dynamicWords = [];

    try {
        dynamicWords = JSON.parse(heroSection?.dataset.dynamicWords || "[]");
    } catch (error) {
        console.error("Failed to parse dynamic words:", error);
        dynamicWords = [];
    }

    document.addEventListener("DOMContentLoaded", () => {
        initHeroAnimation(dynamicWords);
    });
</script>

<style>
    .dynamic-word-wrapper {
        display: inline-block;
        position: relative;
        /* Reserve space for longest word to prevent layout shift */
        min-width: var(--dynamic-word-width, 0);
    }

    #dynamic-word {
        display: inline-block;
        transition:
            opacity 0.3s ease,
            transform 0.3s ease;
        white-space: nowrap;
    }

    @media (max-width: 768px) {
        #dynamic-word {
            font-size: 1em;
        }
    }

    @media (max-width: 480px) {
        #dynamic-word {
            font-size: 1em;
        }
    }
</style>

<script define:vars={{ dynamicWords }}>
    // Calculate actual pixel width of longest word
    function calculateLongestWordWidth() {
        const longestWord = dynamicWords.reduce(
            (a, b) => (a.length > b.length ? a : b),
            "",
        );

        // Create temporary element to measure actual width
        const temp = document.createElement("span");
        temp.style.visibility = "hidden";
        temp.style.position = "absolute";
        temp.style.whiteSpace = "nowrap";

        // Copy styles from hero title
        const heroTitle = document.querySelector(".hero-title");
        if (heroTitle) {
            const styles = window.getComputedStyle(heroTitle);
            temp.style.fontSize = styles.fontSize;
            temp.style.fontWeight = styles.fontWeight;
            temp.style.fontFamily = styles.fontFamily;
            temp.style.letterSpacing = styles.letterSpacing;
        }

        temp.textContent = longestWord;
        document.body.appendChild(temp);
        const width = temp.offsetWidth;
        document.body.removeChild(temp);

        return `${width}px`;
    }

    // Set width after fonts load
    if (document.fonts && document.fonts.ready) {
        document.fonts.ready.then(() => {
            const width = calculateLongestWordWidth();
            document.documentElement.style.setProperty(
                "--dynamic-word-width",
                width,
            );
        });
    } else {
        // Fallback for browsers without Font Loading API
        setTimeout(() => {
            const width = calculateLongestWordWidth();
            document.documentElement.style.setProperty(
                "--dynamic-word-width",
                width,
            );
        }, 100);
    }
</script>
