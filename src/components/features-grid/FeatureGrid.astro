---
interface Feature {
    icon: string;
    title: string;
    description: string;
}

interface CTAProps {
    title: string;
    subtitle?: string;
    primaryButton: {
        text: string;
        href: string;
        icon?: string;
    };
    secondaryButton?: {
        text: string;
        href: string;
        icon?: string;
    };
    variant?: "default" | "urgent" | "success";
    backgroundColor?: "white" | "gray" | "gradient";
}

interface Props {
    title: string;
    subtitle: string;
    features: Feature[];
    sectionId?: string;
    backgroundColor?: "white" | "gray";
    className?: string;
    autoplay?: boolean;
    autoplayDelay?: number;
    cta?: CTAProps;
}

const {
    title,
    subtitle,
    features,
    sectionId = "",
    backgroundColor = "white",
    className = "",
    autoplay = false,
    autoplayDelay = 5000,
    cta,
} = Astro.props;

// Generate unique slider ID based on section or title
const sliderId = sectionId || title.toLowerCase().replace(/\s+/g, "-");
---

<section
    class={`section-spacing feature-section ${backgroundColor === "gray" ? "bg-gray" : ""} ${className}`}
    id={sectionId}
>
    <div class="container">
        <div class="text-center">
            <h2 class="section-title">{title}</h2>
            <p class="section-subtitle">{subtitle}</p>
        </div>

        <div class="feature-grid">
            <div class="feature-slider-wrapper">
                <button
                    class="feature-nav feature-nav-prev"
                    aria-label="Anterior"
                >
                    <span class="material-symbols-outlined">chevron_left</span>
                </button>

                <div
                    class="grid-3 feature-slider-track"
                    data-slider={sliderId}
                    data-slider-autoplay={autoplay.toString()}
                    data-slider-delay={autoplayDelay.toString()}
                >
                    {
                        features.map((feature) => (
                            <div class="feature-card">
                                <span class="material-symbols-outlined">
                                    {feature.icon}
                                </span>
                                <h3>{feature.title}</h3>
                                <p>{feature.description}</p>
                            </div>
                        ))
                    }
                </div>

                <button
                    class="feature-nav feature-nav-next"
                    aria-label="PrÃ³ximo"
                >
                    <span class="material-symbols-outlined">chevron_right</span>
                </button>
            </div>
            <div class="slider-indicators" id={`slider-indicators-${sliderId}`}>
            </div>
        </div>

        {
            cta && (
                <div class="feature-cta">
                    <div class="cta-inline__wrapper">
                        <div
                            class={`cta-inline__content cta-inline--${cta.variant || "default"}`}
                        >
                            <div class="cta-inline__text">
                                <h2 class="cta-inline__title">{cta.title}</h2>
                                {cta.subtitle && (
                                    <p class="cta-inline__subtitle">
                                        {cta.subtitle}
                                    </p>
                                )}
                            </div>

                            <div class="cta-inline__actions">
                                <a
                                    href={cta.primaryButton.href}
                                    class="cta-btn cta-btn--primary"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                >
                                    {cta.primaryButton.icon && (
                                        <span class="material-symbols-outlined">
                                            {cta.primaryButton.icon}
                                        </span>
                                    )}
                                    <span class="cta-btn__text">
                                        {cta.primaryButton.text}
                                    </span>
                                    <span class="cta-btn__arrow material-symbols-outlined">
                                        arrow_forward
                                    </span>
                                </a>
                                {cta.secondaryButton && (
                                    <a
                                        href={cta.secondaryButton.href}
                                        class="cta-btn cta-btn--secondary"
                                    >
                                        {cta.secondaryButton.icon && (
                                            <span class="material-symbols-outlined">
                                                {cta.secondaryButton.icon}
                                            </span>
                                        )}
                                        <span class="cta-btn__text">
                                            {cta.secondaryButton.text}
                                        </span>
                                    </a>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            )
        }
    </div>
</section>

<style>
    @import "../../styles/components/feature-grid.css";
</style>

<script>
    import { initFeatureGrid } from "../../scripts/feature-grid";

    document.addEventListener("DOMContentLoaded", () => {
        initFeatureGrid();
    });
</script>
